# BastionAuth Security Penetration Testing Checklist

## Overview

This document outlines the security penetration testing requirements for BastionAuth before production deployment. All items marked as **Critical** must be completed by a qualified security professional.

> ðŸ“‹ **See Also:** [PENTEST_SCHEDULE.md](./PENTEST_SCHEDULE.md) for vendor selection, timeline planning, and budget considerations.

> ðŸ”’ **See Also:** [SECURITY_SCANNING.md](./SECURITY_SCANNING.md) for automated OWASP ZAP security scanning.

---

## Pre-Production Security Requirements

### 1. Professional Penetration Test Scope

| Area | Priority | Status |
|------|----------|--------|
| Authentication bypass testing | Critical | â¬œ Pending |
| Authorization/privilege escalation | Critical | â¬œ Pending |
| Session management security | Critical | â¬œ Pending |
| Token security (JWT, refresh) | Critical | â¬œ Pending |
| API security testing | Critical | â¬œ Pending |
| Input validation (injection attacks) | Critical | â¬œ Pending |
| Cryptographic implementation review | High | â¬œ Pending |
| Rate limiting effectiveness | High | â¬œ Pending |
| OAuth flow security | High | â¬œ Pending |
| MFA bypass attempts | High | â¬œ Pending |

---

## Detailed Testing Areas

### Authentication Security

- [ ] **Password brute force protection**
  - Verify account lockout after configurable failed attempts
  - Confirm lockout duration is enforced
  - Test lockout bypass attempts

- [ ] **Credential stuffing resistance**
  - Rate limiting per IP address
  - Rate limiting per email/username
  - CAPTCHA integration (if applicable)

- [ ] **Account enumeration prevention**
  - Sign-in error messages are identical for wrong password vs non-existent account
  - Password reset doesn't reveal account existence
  - Sign-up handles duplicate email gracefully

- [ ] **Password security**
  - Argon2id hashing verification
  - Password complexity enforcement
  - HaveIBeenPwned breach detection integration
  - No passwords in logs or error messages

### Session Management

- [ ] **Session token security**
  - Refresh tokens are cryptographically random
  - Tokens are stored as hashes in database
  - Session invalidation on password change
  - Session invalidation on logout

- [ ] **Cookie security**
  - HttpOnly flag set
  - Secure flag set (HTTPS only)
  - SameSite attribute configured
  - Appropriate expiration times

- [ ] **JWT security**
  - RS256 algorithm enforced (no alg:none)
  - Key rotation capability
  - Appropriate expiration (15 minutes)
  - No sensitive data in payload

### Authorization

- [ ] **Horizontal privilege escalation**
  - User cannot access other users' data
  - User cannot modify other users' profiles
  - User cannot view other users' sessions

- [ ] **Vertical privilege escalation**
  - Regular user cannot access admin endpoints
  - Regular user cannot elevate to admin role
  - API key scope enforcement

- [ ] **IDOR vulnerabilities**
  - Sequential ID guessing prevention
  - Resource ownership validation

### Multi-Factor Authentication

- [ ] **TOTP security**
  - Secrets encrypted at rest (AES-256-GCM)
  - Time-based validation with drift allowance
  - Replay attack prevention

- [ ] **Backup codes**
  - One-time use enforcement
  - Encrypted storage
  - Secure generation

- [ ] **MFA bypass attempts**
  - Cannot skip MFA challenge
  - Challenge expiration enforced
  - Attempt limiting

### Input Validation

- [ ] **Injection attacks**
  - SQL injection in all input fields
  - NoSQL injection
  - Command injection
  - LDAP injection (if applicable)

- [ ] **Cross-Site Scripting (XSS)**
  - Reflected XSS
  - Stored XSS
  - DOM-based XSS

- [ ] **Other injection types**
  - Path traversal
  - CRLF injection
  - Header injection

### API Security

- [ ] **Authentication**
  - All protected endpoints require valid token
  - Expired tokens rejected
  - Revoked tokens rejected

- [ ] **Rate limiting**
  - All endpoints have appropriate limits
  - Bypass prevention (header manipulation, IP rotation)

- [ ] **CORS configuration**
  - Allowed origins properly configured
  - Credentials handling

- [ ] **Security headers**
  - X-Frame-Options
  - X-Content-Type-Options
  - X-XSS-Protection
  - Content-Security-Policy
  - Strict-Transport-Security

### OAuth Security

- [ ] **State parameter validation**
  - CSRF protection via state
  - State cannot be reused

- [ ] **Redirect URI validation**
  - Only whitelisted URIs allowed
  - No open redirects

- [ ] **Token handling**
  - OAuth tokens encrypted at rest
  - Secure token exchange

### Cryptography

- [ ] **Key management**
  - RSA keys are 4096-bit
  - Keys stored securely
  - Key rotation process exists

- [ ] **Encryption**
  - AES-256-GCM for sensitive data
  - Proper IV/nonce handling
  - No hardcoded keys

- [ ] **Hashing**
  - Argon2id with secure parameters
  - SHA-256 for token hashing

---

## Recommended Penetration Testing Vendors

| Vendor | Specialty | Contact |
|--------|-----------|---------|
| [NCC Group](https://www.nccgroup.com/) | Enterprise security | Request quote |
| [Cure53](https://cure53.de/) | Web application security | Request quote |
| [PortSwigger](https://portswigger.net/web-security-consulting) | Web security experts | Request quote |
| [Synack](https://www.synack.com/) | Crowdsourced pentesting | Request quote |

---

## Automated Security Scanning

### Tools to Run Before Pentest

```bash
# OWASP ZAP automated scan
docker run -t owasp/zap2docker-stable zap-baseline.py -t https://api.bastionauth.dev

# Nuclei vulnerability scanner
nuclei -u https://api.bastionauth.dev -t cves/ -t exposures/

# SQLMap for injection testing
sqlmap -u "https://api.bastionauth.dev/api/v1/auth/sign-in" --data="email=test&password=test"

# Nikto web server scanner
nikto -h https://api.bastionauth.dev
```

### Continuous Security Scanning (CI/CD)

- [ ] Snyk for dependency vulnerabilities
- [ ] GitHub Dependabot alerts
- [ ] SAST scanning on every PR
- [ ] DAST scanning on staging deployments

---

## Post-Pentest Actions

### Severity Classification

| Severity | Response Time | Action Required |
|----------|--------------|-----------------|
| Critical | Immediate | Block deployment, fix immediately |
| High | 24-48 hours | Fix before production |
| Medium | 1-2 weeks | Fix in next sprint |
| Low | 1 month | Add to backlog |
| Informational | Optional | Document for future |

### Remediation Process

1. Receive pentest report
2. Triage findings by severity
3. Create tickets for each finding
4. Fix critical/high issues
5. Request re-test of fixed issues
6. Document lessons learned
7. Update security practices

---

## Compliance Checklist

| Standard | Requirement | Status |
|----------|-------------|--------|
| OWASP Top 10 | Address all categories | â¬œ Pending |
| SOC 2 Type II | Security controls documented | â¬œ Pending |
| GDPR | Data protection measures | â¬œ Pending |
| PCI DSS | If handling payment data | â¬œ N/A |

---

## Contact Information

- **Security Lead**: [Assign before pentest]
- **External Pentest Vendor**: [To be selected]
- **Bug Bounty Program**: [Consider setting up]

---

## Timeline

| Phase | Duration | Target Date |
|-------|----------|-------------|
| Vendor selection | 1 week | TBD |
| Scoping call | 1 day | TBD |
| Penetration test | 2-3 weeks | TBD |
| Report delivery | 1 week | TBD |
| Remediation | 2-4 weeks | TBD |
| Re-test | 1 week | TBD |
| Production launch | - | After all critical/high fixed |

