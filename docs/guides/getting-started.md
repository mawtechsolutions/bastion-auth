# Getting Started with BastionAuth

This guide will help you get BastionAuth up and running in your project.

## Prerequisites

Before you begin, make sure you have:

- **Node.js 20+** installed
- **pnpm 8+** package manager
- **Docker & Docker Compose** for local development
- A code editor (VS Code recommended)

## Installation

### 1. Clone and Setup

```bash
# Clone the repository
git clone https://github.com/bastionauth/bastionauth.git
cd bastionauth

# Run the setup script
./scripts/setup.sh
```

The setup script will:
- Install all dependencies
- Generate RSA keys for JWT signing
- Create environment configuration files

### 2. Start Docker Services

```bash
# Start PostgreSQL and Redis
pnpm docker:up
```

### 3. Initialize Database

```bash
# Generate Prisma client
pnpm db:generate

# Run migrations
pnpm db:migrate

# Seed with test data (optional)
pnpm db:seed
```

### 4. Start Development Server

```bash
# Start all packages in dev mode
pnpm dev
```

This will start:
- **API Server**: http://localhost:3001
- **Example App**: http://localhost:3000
- **Admin Dashboard**: http://localhost:3002

## Environment Configuration

Copy the example env file and configure:

```bash
cp env.example .env
```

### Required Variables

```env
# Database
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/bastionauth"

# Redis
REDIS_URL="redis://localhost:6379"

# JWT Keys (generated by setup script)
JWT_PRIVATE_KEY_PATH="./keys/private.pem"
JWT_PUBLIC_KEY_PATH="./keys/public.pem"

# Encryption
ENCRYPTION_KEY="your-32-character-encryption-key"

# Email (Resend)
RESEND_API_KEY="re_..."
FROM_EMAIL="noreply@yourdomain.com"

# URLs
API_URL="http://localhost:3001"
APP_URL="http://localhost:3000"
```

## Quick Integration

### React App

Install the React SDK:

```bash
pnpm add @bastionauth/react
```

Wrap your app with the provider:

```tsx
import { BastionProvider } from '@bastionauth/react';

function App() {
  return (
    <BastionProvider 
      publishableKey="pk_test_..."
      apiUrl="http://localhost:3001"
    >
      {children}
    </BastionProvider>
  );
}
```

Add authentication components:

```tsx
import { SignIn, SignUp, UserButton } from '@bastionauth/react';

function AuthPage() {
  return <SignIn redirectUrl="/dashboard" />;
}

function Header() {
  return (
    <header>
      <UserButton />
    </header>
  );
}
```

### Next.js App

Install the Next.js package:

```bash
pnpm add @bastionauth/nextjs
```

Add the middleware:

```typescript
// middleware.ts
import { authMiddleware } from '@bastionauth/nextjs';

export default authMiddleware({
  publicRoutes: ['/', '/sign-in', '/sign-up'],
});

export const config = {
  matcher: ['/((?!.*\\..*|_next).*)', '/', '/(api|trpc)(.*)'],
};
```

Wrap your layout with the provider:

```tsx
// app/layout.tsx
import { BastionProvider } from '@bastionauth/react';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        <BastionProvider>
          {children}
        </BastionProvider>
      </body>
    </html>
  );
}
```

## Next Steps

- [Configure OAuth Providers](./oauth-setup.md)
- [Set up Multi-Factor Authentication](./mfa-setup.md)
- [Deploy to Production](./self-hosting.md)
- [API Reference](../api/README.md)

## Troubleshooting

### Docker Issues

If Docker services fail to start:

```bash
# Check logs
pnpm docker:logs

# Restart services
pnpm docker:down && pnpm docker:up
```

### Database Issues

```bash
# Reset database (WARNING: destroys data)
pnpm db:reset

# Open Prisma Studio to inspect data
pnpm db:studio
```

### Port Conflicts

If default ports are in use, modify `env.example`:

```env
PORT=3001        # API server
NEXT_PORT=3000   # Next.js app
ADMIN_PORT=3002  # Admin dashboard
```

